---
title: "ETC3250 Lab 8"
author: "Di Cook"
date: "15 September 2015"
output: pdf_document
---


# Supervised classification, and data visualisation

## Task 1

Read in the music data, from the ggobi web site:

```{r, echo=FALSE, message=FALSE, warning=FALSE, error=FALSE}
library(ggplot2)
library(tidyr)
library(dplyr)
library(lubridate)
library(GGally)
music <- read.csv("http://www.ggobi.org/book/data/music-sub.csv", 
                  row.names=1, stringsAsFactors = FALSE)
music$title <- rownames(music)
```

1. Subset the data to drop the "Enya" class. 

```{r, echo=FALSE, message=FALSE, warning=FALSE, error=FALSE}
music <- filter(music, type != "New wave")
```

2. Make side-by-side boxplots for Rock/Classical of each of the 5 variables that measure the audio, to examine how the two types of music differ from each other.

```{r, echo=FALSE, message=FALSE, warning=FALSE, error=FALSE}
music.m <- gather(music, key=variable, value=stat, lvar:lfreq)
qplot(type, stat, data=music.m, geom="boxplot") + 
  facet_wrap(~variable, scales="free_y")
```

3. Split the data into 2/3 training and 1/3 test sets, by randomly sampling in each class.

```{r, echo=FALSE, message=FALSE, warning=FALSE, error=FALSE}
music <- arrange(music, type)
music[,3:7] <- apply(music[,3:7], 2, scale)
indx <- sort(c(sample(1:27, 18), sample(28:59, 20)))
music.tr <- music[indx,]
music.ts <- music[-indx,]
```

## Task 2

1. Compute a logistic regression classifier to distinguish "Rock" from "Classical" music.

```{r, echo=FALSE, message=FALSE, warning=FALSE, error=FALSE}
music.tr$ctype <- as.numeric(plyr::revalue(music.tr$type, 
      c("Rock"="1","Classical"="0")))
glm.fit <- glm(ctype~lvar+lave+lmax+lfener+lfreq, data=music.tr, 
               family=binomial)
summary(glm.fit)
```

2. Predict the error for the training set, and also the test set. 

```{r, echo=FALSE, message=FALSE, warning=FALSE, error=FALSE}
music.tr.p <- predict(glm.fit, music.tr, type="response")
music.tr$ptype <- "Classical"
music.tr$ptype[music.tr.p > 0.5] <- "Rock"
table(music.tr$type, music.tr$ptype)
music.ts.p <- predict(glm.fit, music.ts, type="response")
music.ts$ptype <- "Classical"
music.ts$ptype[music.ts.p > 0.5] <- "Rock"
table(music.ts$type, music.ts$ptype)
```

3. Make a plot that shows the predicted values from the model fit, by music type.

```{r, echo=FALSE, message=FALSE, warning=FALSE, error=FALSE}
music.tr$pred <- music.tr.p
qplot(type, pred, data=music.tr, geom="boxplot")
```

4. Highlight the missclassified cases (for the test set) on a parallel coordinate plot of the 5 variables. Can you see why they might be incorrectly classified?

```{r, echo=FALSE, message=FALSE, warning=FALSE, error=FALSE}
music.ts$correct <- ifelse(music.ts$type == music.ts$ptype, "yes", "no")
music.ts.m <- gather(music.ts, key=variable, value=stat, lvar:lfreq)
qplot(variable, stat, data=music.ts.m, color=type, group=title,
      linetype=correct, geom="line") 
```

5. Can you do as well with fewer variables?

```{r, echo=FALSE, message=FALSE, warning=FALSE, error=FALSE}
glm.fit <- glm(ctype~lvar+lave, data=music.tr, 
               family=binomial)
summary(glm.fit)
music.tr.p <- predict(glm.fit, music.tr, type="response")
music.tr$ptype <- "Classical"
music.tr$ptype[music.tr.p > 0.5] <- "Rock"
table(music.tr$type, music.tr$ptype)
music.ts.p <- predict(glm.fit, music.ts, type="response")
music.ts$ptype <- "Classical"
music.ts$ptype[music.ts.p > 0.5] <- "Rock"
table(music.ts$type, music.ts$ptype)
```

## Assignment

Similarly examine, build a classifier and assess the model fit for the spam data from the ggobi web site. Here is some code to get you started.

```{r, echo=FALSE, message=FALSE, warning=FALSE, error=FALSE}
spam <- read.csv("http://www.ggobi.org/book/data/spam.csv", 
                  stringsAsFactors = FALSE)
spam$nbox <- ifelse(spam$box == "yes", 1, 0)
spam$nlocal <- ifelse(spam$local == "yes", 1, 0)
spam$cspam <- ifelse(spam$spam == "yes", 1, 0)
spam.sub <- select(spam, day.of.week, time.of.day, size.kb, nbox, 
                   nlocal, digits, cappct, cspam)
glm.fit <- glm(cspam~., data=spam.sub, 
               family=binomial)
summary(glm.fit)
```
