---
title: "ETC3250 Lab 7"
author: "Di Cook"
date: "8 September 2015"
output: pdf_document
---


# Making data plots and cleaning data

## Task 1

1. Read in the billboard top 100 music data, which contains N'Sync and Backstreet Boys songs that entered the billboard charts in the year 2000
```{r, echo=FALSE, message=FALSE, warning=FALSE, error=FALSE}
library(ggplot2)
library(tidyr)
library(dplyr)
library(lubridate)
billboard <- read.csv("../data/billboard.csv")
```
2. Use ``tidyr`` to convert this data into a long format appropriate for plotting a time series (date on the x axis, chart position on the y axis)
3. Use ``ggplot2`` to create this time series plot:

```{r, echo=FALSE, fig.width=15, fig.height=5, message=FALSE, warning=FALSE, error=FALSE}
long_billboard <- gather(billboard, key = week, value = rank, X1:X76)
long_billboard$week <- as.numeric(gsub("X", "", long_billboard$week))

qplot(week, rank, data = long_billboard, geom = "line", colour = artist, group = track)
```

## Task 2

Read in the flights data:
```{r, echo=FALSE, message=FALSE, warning=FALSE, error=FALSE}
flights <- read.csv("../data/flights.csv")
```
This dataset contains information on over 300,000 flights that departed from New York City in the year 2013.

1. Using dplyr and the pipe operator, create a data frame consisting of the average arrival delay (``arr_delay``) based on the destination airport (``dest``). Sort this data frame in descending order, so the destination airport with the largest delay is first.
2. Find out the most used airports for each airline carrier.

```{r, echo=FALSE, eval=FALSE}
flights %>% group_by(dest) %>% summarise(m=mean(arr_delay, na.rm=T)) %>% arrange(desc(m))
mymode <- function(x) {
  ux <- unique(x)
  ux[which.max(tabulate(match(x, ux)))]
}
flights %>% group_by(carrier) %>% summarise(m=mymode(dest))
```

## Task 3

1. Using the ``flights`` data, create a new column Date using lubridate. You will need to paste together the columns year, month, and day in order to do this. See the ``paste`` function.
2. Use dplyr to calculate the average departure delay for each date.
3. Plot a time series of the date versus the average departure delay

```{r, echo=FALSE, fig.show='hide'}
flights$date <- ymd(paste(flights$year, flights$month, flights$day, sep = "-"))
delay.dat <- flights %>% group_by(date) %>% summarise(dep_delay = mean(dep_delay, na.rm = TRUE))

qplot(date, dep_delay, geom = "line", data = delay.dat)
```

# Assignment 7

On the PISA data from last week. Make a plot to answer this question:

- Does truancy affect math score, on average?

- And pick one other interesting question based on the data dictionary description information to answer using a plot. 

Write a couple of sentence explaining why you chose the particular plot design, 
and how it helps to answer the question.

Turn in two items: a .Rmd document, and the output .pdf from running it. No need to include the R output and plots in your pdf, but the code should be in the Rmd file. 

