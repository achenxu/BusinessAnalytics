---
title: 'ETC3250 Business Analytics: Advanced Classification - Boosting'
author: "Souhaib Ben Taieb, Di Cook, Rob Hyndman"
date: "October 5, 2015"
output:
  beamer_presentation: 
    theme: Monash
---

## Overview

- Expand the data by giving more weight to the troublesome cases.
- Intuitively, this could be thought of as increasing the amount of data set near the boundaries between the groups.
- Early work description at [http://www.boosting.org](http://www.boosting.org), and see adaboost algorithm

## Algorithm

1. Input: $L = {(x_i, y_i), i=1, ..., n}, y_i \in \{1, ..., g\}$. Set $r_i=y_i$, and $\hat{y}=0$. 
2. For $b =1, 2, ..., B$:
  - Fit $\hat{y}^b$ to $(x, r)$.
  - Update $\hat{y} \leftarrow \hat{y} + \lambda \hat{y}^b$.
  - Update the residuals $r_i \leftarrow r_i + \lambda \hat{y}^b$.
3. Output: boosted model, $\hat{y} = \sum_{b=1}^B \lambda \hat{y}^b$.

## Example

```{r boost, echo=FALSE, message=FALSE, warning=FALSE, error=FALSE}
library(ggplot2)
library(tourr)
library(dplyr)
library(tidyr)
library(scales)
library(rpart)
library(rpart.plot)
library(gridExtra)
library(GGally)
library(randomForest)
library(ggthemes)
library(adabag)

data(olive)
olive.sth <- filter(olive, region==1)
olive.sth <- select(olive.sth, area:eicosenoic)
olive.sth$area <- factor(olive.sth$area, labels=c("Cal","NthAp","Sic","SthAp"))

olive.sth <- arrange(olive.sth, area)
indx <- sort(c(sample(1:56,28), sample(57:81, 13), sample(82:117, 18), sample(118:323, 102)))
olive.s.tr <- olive.sth[indx,]
olive.s.ts <- olive.sth[-indx,]
```

```{r boost2, message=FALSE, warning=FALSE, error=FALSE, results='hold'}
olive.adaboost <- boosting(area~., data=olive.s.tr, control=rpart.control(maxdepth=2))
table(olive.s.tr$area, olive.adaboost$class); table(olive.s.ts$area, predict.boosting(olive.adaboost, olive.s.ts)$class)
```

## Example

```{r boost3, echo=FALSE, message=FALSE, warning=FALSE, error=FALSE, fig.show='hold', fig.height=2, fig.width=2, results='hold'}
indx <- sample(1:100, 2)
prp(olive.adaboost$trees[[indx[1]]])
prp(olive.adaboost$trees[[indx[2]]])
indx
```

## Examine how it performs with different number of steps

```{r boost4, echo=FALSE, message=FALSE, warning=FALSE, error=FALSE, results='hold'}
tr.err <- NULL
ts.err <- NULL
for (i in seq(5, 100, 5)) {
  olive.adaboost <- boosting(area~., data=olive.s.tr, mfinal=i,
          control=rpart.control(maxdepth=2))
#olive.adaboost
  x <- table(olive.s.tr$area, olive.adaboost$class)
  tr.err <- c(tr.err, 1-sum(diag(x))/sum(x))
  y <- table(olive.s.ts$area, predict.boosting(olive.adaboost, olive.s.ts)$class)
  ts.err <- c(ts.err, 1-sum(diag(y))/sum(y))
}
df <- data.frame(ntrees=seq(5, 100, 5), tr.err=tr.err, ts.err=ts.err)
df.m <- gather(df, type, error, -ntrees)
qplot(ntrees, error, data=df.m, colour=type, geom="line") + 
  xlab("Number of steps") + ylab("Error") +
    scale_colour_discrete("Type")
```
